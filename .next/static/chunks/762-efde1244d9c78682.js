"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[762],{8525:(e,t,r)=>{r.d(t,{U:()=>a});var i=r(88727);function a(){return(0,i.createBrowserClient)("https://fszlchqifmvssxxgygij.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZzemxjaHFpZm12c3N4eGd5Z2lqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA3Njk4NzAsImV4cCI6MjA3NjM0NTg3MH0.-cwWKc1l3Af4zjOYIfRIH_bOMuTU82XD8dNK73_qPTE")}},16485:(e,t,r)=>{r.d(t,{A:()=>i});let i=(0,r(45105).A)("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]])},18085:(e,t,r)=>{r.d(t,{A:()=>i});let i=(0,r(45105).A)("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]])},21190:(e,t,r)=>{r.d(t,{A:()=>i});let i=(0,r(45105).A)("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]])},24947:(e,t,r)=>{r.d(t,{A:()=>i});let i=(0,r(45105).A)("Car",[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]])},37586:(e,t,r)=>{r.d(t,{A:()=>i});let i=(0,r(45105).A)("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]])},39867:(e,t,r)=>{r.d(t,{A:()=>i});let i=(0,r(45105).A)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]])},46046:(e,t,r)=>{r.d(t,{A:()=>i});let i=(0,r(45105).A)("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]])},65229:(e,t,r)=>{r.d(t,{A:()=>i});let i=(0,r(45105).A)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},71360:(e,t,r)=>{r.d(t,{A:()=>i});let i=(0,r(45105).A)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},85832:(e,t,r)=>{r.d(t,{A:()=>u});var i=r(95155),a=r(12115),l=r(37586),o=r(45105);let n=(0,o.A)("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]);var d=r(65229),s=r(18085),m=r(46046),c=r(21190),h=r(71360);let y=(0,o.A)("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);var g=r(89715),f=r(39867),p=r(8525);function u(e){let{vehicleId:t,userRole:r}=e,[o,u]=(0,a.useState)([]),[x,b]=(0,a.useState)(""),[w,k]=(0,a.useState)([]),[v,j]=(0,a.useState)(!1),[_,A]=(0,a.useState)(!1),[C,S]=(0,a.useState)(""),[z,I]=(0,a.useState)({}),[M,q]=(0,a.useState)(null),[R,E]=(0,a.useState)(""),[F,T]=(0,a.useState)(""),[H,D]=(0,a.useState)(""),N=(0,p.U)();(0,a.useEffect)(()=>{B(),W()},[t]);let W=async()=>{try{let{data:{user:e}}=await N.auth.getUser();if(e){T(e.id),D(e.email||"");let{data:t}=await N.from("profiles").select("name").eq("id",e.id).single();t?S(t.name||e.email||"User"):S(e.email||"User")}}catch(e){console.error("Error loading user name:",e)}},B=async()=>{try{j(!0);let{data:e,error:r}=await N.from("vehicle_inward_comments").select("*").eq("vehicle_inward_id",t).order("created_at",{ascending:!1});if(r)throw r;if(u(e||[]),e&&e.length>0){let t=e.map(e=>e.id),{data:r}=await N.from("vehicle_inward_comment_attachments").select("*").in("comment_id",t).order("created_at",{ascending:!1}),i={};null==r||r.forEach(e=>{i[e.comment_id]||(i[e.comment_id]=[]),i[e.comment_id].push(e)}),I(i)}}catch(e){console.error("Error loading comments:",e)}finally{j(!1)}},L=async()=>{if(!x.trim()&&0===w.length)return void alert("Please enter a comment or attach a file");A(!0);try{let{data:{user:e}}=await N.auth.getUser();if(!e)return void alert("You must be logged in to add comments");let{data:i,error:a}=await N.from("vehicle_inward_comments").insert({vehicle_inward_id:t,comment:x.trim()||"(No comment - file attachment only)",created_by:C||e.email||e.id,role:r}).select().single();if(a)throw a;if(w.length>0&&i){let e=[];for(let t of w)try{let r=new FileReader,a=new Promise((e,i)=>{r.onload=()=>e(r.result),r.onerror=i,r.readAsDataURL(t)}),l=await a,{error:o}=await N.from("vehicle_inward_comment_attachments").insert({comment_id:i.id,file_name:t.name,file_url:l,file_type:t.type,file_size:t.size});o||e.push({file_name:t.name,file_url:l})}catch(e){console.error("Error uploading file:",e)}e.length>0&&await N.from("vehicle_inward_comments").update({attachments_count:e.length}).eq("id",i.id)}b(""),k([]),await B(),alert("Comment added successfully!")}catch(e){console.error("Error submitting comment:",e),alert("Failed to add comment: ".concat(e.message))}finally{A(!1)}},U=async e=>{if(!R.trim())return void alert("Comment cannot be empty");try{let{error:t}=await N.from("vehicle_inward_comments").update({comment:R.trim()}).eq("id",e);if(t)throw t;q(null),E(""),await B(),alert("Comment updated successfully!")}catch(e){console.error("Error updating comment:",e),alert("Failed to update comment: ".concat(e.message))}},Z=()=>{q(null),E("")},J=async e=>{if(confirm("Are you sure you want to delete this comment? This will also delete all attachments."))try{let{error:t}=await N.from("vehicle_inward_comments").delete().eq("id",e);if(t)throw t;await B(),alert("Comment deleted successfully!")}catch(e){console.error("Error deleting comment:",e),alert("Failed to delete comment: ".concat(e.message))}},O=async(e,t)=>{if(confirm("Are you sure you want to delete this attachment?"))try{var r;let{error:i}=await N.from("vehicle_inward_comment_attachments").delete().eq("id",e);if(i)throw i;let a=((null==(r=z[t])?void 0:r.length)||1)-1;await N.from("vehicle_inward_comments").update({attachments_count:a}).eq("id",t),await B(),alert("Attachment deleted successfully!")}catch(e){console.error("Error deleting attachment:",e),alert("Failed to delete attachment: ".concat(e.message))}},V=e=>"admin"===r||"manager"===r||e.created_by===F||e.created_by===H||e.created_by===C;return(0,i.jsxs)("div",{style:{marginTop:"2rem",padding:"1.5rem",backgroundColor:"#f9fafb",borderRadius:"0.75rem",border:"1px solid #e5e7eb"},children:[(0,i.jsxs)("h3",{style:{fontSize:"1rem",fontWeight:"700",color:"#111827",marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,i.jsx)(l.A,{style:{width:"1.25rem",height:"1.25rem"}}),"Comments & Attachments"]}),(0,i.jsxs)("div",{style:{backgroundColor:"white",borderRadius:"0.5rem",padding:"1rem",marginBottom:"1.5rem",border:"1px solid #e5e7eb"},children:[(0,i.jsx)("textarea",{value:x,onChange:e=>b(e.target.value),placeholder:"Add a comment...",style:{width:"100%",minHeight:"100px",padding:"0.75rem",border:"1px solid #d1d5db",borderRadius:"0.5rem",fontSize:"0.875rem",fontFamily:"inherit",resize:"vertical",outline:"none"},onFocus:e=>{e.target.style.borderColor="#3b82f6",e.target.style.boxShadow="0 0 0 3px rgba(59, 130, 246, 0.1)"},onBlur:e=>{e.target.style.borderColor="#d1d5db",e.target.style.boxShadow="none"}}),(0,i.jsxs)("div",{style:{marginTop:"0.75rem",marginBottom:"0.75rem"},children:[(0,i.jsxs)("label",{style:{display:"inline-flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:"#f3f4f6",border:"1px solid #d1d5db",borderRadius:"0.5rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:"500",color:"#374151"},children:[(0,i.jsx)(n,{style:{width:"1rem",height:"1rem"}}),"Attach Files",(0,i.jsx)("input",{type:"file",multiple:!0,onChange:e=>{if(e.target.files){let t=Array.from(e.target.files);k(e=>[...e,...t].slice(0,5))}},style:{display:"none"},accept:"image/*,.pdf,.doc,.docx"})]}),w.length>0&&(0,i.jsx)("div",{style:{marginTop:"0.75rem",display:"flex",flexWrap:"wrap",gap:"0.5rem"},children:w.map((e,t)=>(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 0.75rem",backgroundColor:"#eff6ff",border:"1px solid #dbeafe",borderRadius:"0.5rem",fontSize:"0.75rem"},children:[(0,i.jsx)(n,{style:{width:"0.875rem",height:"0.875rem",color:"#2563eb"}}),(0,i.jsx)("span",{style:{color:"#1e40af",maxWidth:"200px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.name}),(0,i.jsx)("button",{onClick:()=>{k(e=>e.filter((e,r)=>r!==t))},style:{padding:"0.125rem",backgroundColor:"transparent",border:"none",cursor:"pointer",display:"flex",alignItems:"center"},children:(0,i.jsx)(d.A,{style:{width:"0.875rem",height:"0.875rem",color:"#dc2626"}})})]},t))})]}),(0,i.jsxs)("button",{onClick:L,disabled:_||!x.trim()&&0===w.length,style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.75rem 1.5rem",backgroundColor:_||!x.trim()&&0===w.length?"#9ca3af":"#2563eb",color:"white",border:"none",borderRadius:"0.5rem",fontSize:"0.875rem",fontWeight:"600",cursor:_||!x.trim()&&0===w.length?"not-allowed":"pointer",transition:"all 0.2s"},onMouseEnter:e=>{!_&&(x.trim()||w.length>0)&&(e.currentTarget.style.backgroundColor="#1d4ed8")},onMouseLeave:e=>{!_&&(x.trim()||w.length>0)&&(e.currentTarget.style.backgroundColor="#2563eb")},children:[(0,i.jsx)(s.A,{style:{width:"1rem",height:"1rem"}}),_?"Adding...":"Add Comment"]})]}),v?(0,i.jsx)("div",{style:{textAlign:"center",padding:"2rem",color:"#6b7280"},children:"Loading comments..."}):0===o.length?(0,i.jsx)("div",{style:{padding:"2rem",textAlign:"center",backgroundColor:"white",borderRadius:"0.5rem",border:"1px dashed #d1d5db",color:"#6b7280"},children:"No comments yet. Be the first to add one!"}):(0,i.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:o.map(e=>(0,i.jsxs)("div",{style:{backgroundColor:"white",borderRadius:"0.5rem",padding:"1rem",border:"1px solid #e5e7eb"},children:[(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"0.5rem"},children:[(0,i.jsxs)("div",{style:{flex:1},children:[(0,i.jsx)("div",{style:{fontWeight:"600",fontSize:"0.875rem",color:"#111827"},children:e.created_by}),(0,i.jsxs)("div",{style:{fontSize:"0.75rem",color:"#6b7280"},children:[e.role.charAt(0).toUpperCase()+e.role.slice(1)," â€¢ ",new Date(e.created_at).toLocaleString("en-IN",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})]})]}),V(e)&&(0,i.jsx)("div",{style:{display:"flex",gap:"0.5rem"},children:M===e.id?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("button",{onClick:()=>U(e.id),style:{padding:"0.25rem 0.5rem",backgroundColor:"#059669",color:"white",border:"none",borderRadius:"0.375rem",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.25rem",fontSize:"0.75rem",fontWeight:"500"},children:[(0,i.jsx)(m.A,{style:{width:"0.875rem",height:"0.875rem"}}),"Save"]}),(0,i.jsxs)("button",{onClick:Z,style:{padding:"0.25rem 0.5rem",backgroundColor:"#6b7280",color:"white",border:"none",borderRadius:"0.375rem",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.25rem",fontSize:"0.75rem",fontWeight:"500"},children:[(0,i.jsx)(d.A,{style:{width:"0.875rem",height:"0.875rem"}}),"Cancel"]})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("button",{onClick:()=>{q(e.id),E(e.comment)},style:{padding:"0.25rem 0.5rem",backgroundColor:"#2563eb",color:"white",border:"none",borderRadius:"0.375rem",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.25rem",fontSize:"0.75rem",fontWeight:"500"},children:[(0,i.jsx)(c.A,{style:{width:"0.875rem",height:"0.875rem"}}),"Edit"]}),(0,i.jsxs)("button",{onClick:()=>J(e.id),style:{padding:"0.25rem 0.5rem",backgroundColor:"#dc2626",color:"white",border:"none",borderRadius:"0.375rem",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.25rem",fontSize:"0.75rem",fontWeight:"500"},children:[(0,i.jsx)(h.A,{style:{width:"0.875rem",height:"0.875rem"}}),"Delete"]})]})})]}),M===e.id?(0,i.jsx)("textarea",{value:R,onChange:e=>E(e.target.value),style:{width:"100%",minHeight:"80px",padding:"0.75rem",border:"1px solid #3b82f6",borderRadius:"0.5rem",fontSize:"0.875rem",fontFamily:"inherit",resize:"vertical",outline:"none",marginBottom:"0.75rem"}}):(0,i.jsx)("div",{style:{fontSize:"0.875rem",color:"#374151",lineHeight:"1.6",marginBottom:e.attachments_count&&e.attachments_count>0||z[e.id]&&z[e.id].length>0?"0.75rem":"0"},children:e.comment}),z[e.id]&&z[e.id].length>0&&(0,i.jsxs)("div",{style:{padding:"0.75rem",backgroundColor:"#f9fafb",borderRadius:"0.375rem",display:"flex",flexDirection:"column",gap:"0.5rem"},children:[(0,i.jsxs)("div",{style:{fontSize:"0.75rem",fontWeight:"600",color:"#374151",marginBottom:"0.25rem"},children:["\uD83D\uDCCE Attachments (",z[e.id].length,")"]}),z[e.id].map(t=>{var r;return(0,i.jsxs)("a",{href:t.file_url,target:"_blank",rel:"noopener noreferrer",style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem",backgroundColor:"white",borderRadius:"0.375rem",border:"1px solid #e5e7eb",textDecoration:"none",color:"#2563eb",fontSize:"0.75rem",transition:"all 0.2s"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#eff6ff",e.currentTarget.style.borderColor="#3b82f6"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="white",e.currentTarget.style.borderColor="#e5e7eb"},children:[(null==(r=t.file_type)?void 0:r.startsWith("image/"))?(0,i.jsx)(y,{style:{width:"1rem",height:"1rem"}}):(0,i.jsx)(g.A,{style:{width:"1rem",height:"1rem"}}),(0,i.jsx)("span",{style:{flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.file_name}),t.file_size&&(0,i.jsxs)("span",{style:{fontSize:"0.7rem",color:"#6b7280"},children:[(t.file_size/1024).toFixed(1)," KB"]}),(0,i.jsx)(f.A,{style:{width:"0.875rem",height:"0.875rem"}}),V(e)&&(0,i.jsx)("button",{onClick:r=>{r.preventDefault(),r.stopPropagation(),O(t.id,e.id)},style:{padding:"0.25rem",backgroundColor:"transparent",border:"none",cursor:"pointer",display:"flex",alignItems:"center",marginLeft:"0.5rem"},children:(0,i.jsx)(h.A,{style:{width:"0.875rem",height:"0.875rem",color:"#dc2626"}})})]},t.id)})]})]},e.id))})]})}},89715:(e,t,r)=>{r.d(t,{A:()=>i});let i=(0,r(45105).A)("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]])},91761:(e,t,r)=>{r.d(t,{A:()=>i});let i=(0,r(45105).A)("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]])}}]);