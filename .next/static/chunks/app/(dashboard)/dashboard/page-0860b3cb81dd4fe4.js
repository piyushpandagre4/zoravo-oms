(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[337],{919:(e,t,r)=>{"use strict";r.d(t,{A:()=>o});let o=(0,r(45105).A)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},1524:(e,t,r)=>{"use strict";r.d(t,{A:()=>o});let o=(0,r(45105).A)("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]])},6191:(e,t,r)=>{"use strict";r.d(t,{A:()=>o});let o=(0,r(45105).A)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},18517:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>j});var o=r(95155),i=r(12115),n=r(20063),a=r(1524);let s=(0,r(45105).A)("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);var l=r(919),d=r(6191),c=r(24947),m=r(53842),u=r(16485),h=r(89715),g=r(91761),p=r(8525);class f{async getDashboardKPIs(){try{let e=new Date().toISOString().split("T")[0],t=new Date().toISOString().substring(0,7);new Date(Date.now()-2592e6).toISOString().substring(0,7);let{data:r}=await this.supabase.from("vehicles").select("id").eq("status","in_workshop"),{data:o}=await this.supabase.from("work_orders").select("id").eq("status","in_progress"),{data:i}=await this.supabase.from("vehicles").select("id").gte("created_at","".concat(e,"T00:00:00")).lte("created_at","".concat(e,"T23:59:59")),{data:n}=await this.supabase.from("invoices").select("id").eq("status","pending"),{data:a}=await this.supabase.from("invoices").select("id").eq("status","overdue"),{data:s}=await this.supabase.from("invoices").select("total_amount").eq("status","paid").gte("paid_date","".concat(t,"-01")).lte("paid_date","".concat(t,"-31")),l=(null==s?void 0:s.reduce((e,t)=>e+t.total_amount,0))||0;return{vehiclesInWorkshop:(null==r?void 0:r.length)||0,jobsInProgress:(null==o?void 0:o.length)||0,todaysIntakes:(null==i?void 0:i.length)||0,unpaidInvoices:(null==n?void 0:n.length)||0,overduePayments:(null==a?void 0:a.length)||0,monthlyRevenue:l,vehiclesInWorkshopChange:2,jobsInProgressChange:1,todaysIntakesChange:3,unpaidInvoicesChange:-1,overduePaymentsChange:0,monthlyRevenueChange:15}}catch(e){throw console.error("Error fetching dashboard KPIs:",e),e}}async getVehicles(){try{let{data:e,error:t}=await this.supabase.from("vehicles").select("\n          *,\n          customer:customers(*)\n        ").order("created_at",{ascending:!1});if(t)throw t;return e||[]}catch(e){throw console.error("Error fetching vehicles:",e),e}}async getVehicleById(e){try{let{data:t,error:r}=await this.supabase.from("vehicles").select("\n          *,\n          customer:customers(*)\n        ").eq("id",e).single();if(r)throw r;return t}catch(e){throw console.error("Error fetching vehicle:",e),e}}async createVehicle(e){try{let{data:t,error:r}=await this.supabase.from("vehicles").insert(e).select("\n          *,\n          customer:customers(*)\n        ").single();if(r)throw r;return t}catch(e){throw console.error("Error creating vehicle:",e),e}}async updateVehicle(e,t){try{let{data:r,error:o}=await this.supabase.from("vehicles").update(t).eq("id",e).select("\n          *,\n          customer:customers(*)\n        ").single();if(o)throw o;return r}catch(e){throw console.error("Error updating vehicle:",e),e}}async getWorkOrders(){try{let{data:e,error:t}=await this.supabase.from("work_orders").select("\n          *,\n          vehicle:vehicles(*)\n        ").order("created_at",{ascending:!1});if(t)throw t;return e||[]}catch(e){throw console.error("Error fetching work orders:",e),e}}async getWorkOrdersByVehicle(e){try{let{data:t,error:r}=await this.supabase.from("work_orders").select("\n          *,\n          vehicle:vehicles(*)\n        ").eq("vehicle_id",e).order("created_at",{ascending:!1});if(r)throw r;return t||[]}catch(e){throw console.error("Error fetching work orders by vehicle:",e),e}}async getInvoices(){try{let{data:e,error:t}=await this.supabase.from("invoices").select("*").order("created_at",{ascending:!1});if(t)throw t;if(!e||0===e.length)return[];let r=e.map(e=>e.vehicle_id).filter(Boolean);if(r.length>0){let{data:t}=await this.supabase.from("vehicles").select("*, customer:customers(*)").in("id",r),o=new Map((null==t?void 0:t.map(e=>[e.id,e]))||[]);e.forEach(e=>{o.has(e.vehicle_id)&&(e.vehicle=o.get(e.vehicle_id))})}return e||[]}catch(e){throw console.error("Error fetching invoices:",e),e}}async getInvoicesByVehicle(e){try{let{data:t,error:r}=await this.supabase.from("invoices").select("*").eq("vehicle_id",e).order("created_at",{ascending:!1});if(r)throw r;if(!t||0===t.length)return[];let{data:o}=await this.supabase.from("vehicles").select("*, customer:customers(*)").eq("id",e).single();return o&&t.forEach(e=>{e.vehicle=o}),t||[]}catch(e){throw console.error("Error fetching invoices by vehicle:",e),e}}async getServiceTrackers(){try{let{data:e,error:t}=await this.supabase.from("service_trackers").select("\n          *,\n          vehicle:vehicles(*),\n          work_order:work_orders(*)\n        ").order("created_at",{ascending:!1});if(t)throw t;return e||[]}catch(e){throw console.error("Error fetching service trackers:",e),e}}async getFollowUps(){try{let{data:e,error:t}=await this.supabase.from("follow_ups").select("\n          *,\n          vehicle:vehicles(*),\n          customer:customers(*)\n        ").order("next_call_date",{ascending:!0});if(t)throw t;return e||[]}catch(e){throw console.error("Error fetching follow-ups:",e),e}}async getRequirements(){try{let{data:e,error:t}=await this.supabase.from("requirements").select("\n          *,\n          customer:customers(*),\n          vehicle:vehicles(*)\n        ").order("created_at",{ascending:!1});if(t)throw t;return e||[]}catch(e){throw console.error("Error fetching requirements:",e),e}}async getCustomers(){try{let{data:e,error:t}=await this.supabase.from("customers").select("*").order("created_at",{ascending:!1});if(t)throw t;return e||[]}catch(e){throw console.error("Error fetching customers:",e),e}}async createCustomer(e){try{let{data:t,error:r}=await this.supabase.from("customers").insert(e).select().single();if(r)throw r;return t}catch(e){throw console.error("Error creating customer:",e),e}}async getRecentVehicles(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;try{let t=new Date;t.setHours(t.getHours()-24),t.toISOString();let{data:r,error:o}=await this.supabase.from("vehicle_inward").select("*").order("created_at",{ascending:!1}).limit(2*e);if(!o&&r&&r.length>0)return r.filter(e=>{var r;let o=(null==(r=e.status)?void 0:r.toLowerCase().trim())||"";return!(("installation_complete"===o||"installation complete"===o)&&new Date(e.updated_at||e.created_at)<t)&&!0}).slice(0,e).map(e=>({id:e.id,registration_number:e.registration_number,make:e.make||"Unknown",model:e.model,year:e.year,color:e.color,vehicle_type:e.vehicle_type,customer:{name:e.customer_name,phone:e.customer_phone,email:e.customer_email,address:e.customer_address},status:e.status||"pending",issues_reported:e.issues_reported,accessories_requested:e.accessories_requested,estimated_cost:e.estimated_cost,assigned_manager_id:e.assigned_manager_id,assigned_installer_id:e.assigned_installer_id,location_id:e.location_id,estimated_completion_date:e.estimated_completion_date,created_at:e.created_at,updated_at:e.updated_at}));let{data:i,error:n}=await this.supabase.from("vehicles").select("\n          *,\n          customer:customers(*)\n        ").order("created_at",{ascending:!1}).limit(e);if(n)throw n;return i||[]}catch(e){throw console.error("Error fetching recent vehicles:",e),e}}async getRecentInvoices(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;try{let{data:t,error:r}=await this.supabase.from("invoices").select("*").order("created_at",{ascending:!1}).limit(e);if(r)throw r;let o=t||[],{data:i}=await this.supabase.from("vehicle_inward").select("*").eq("status","installation_complete").order("updated_at",{ascending:!1}).limit(2*e),n=(i||[]).map(e=>{var t;let r=0,o=[];try{let t=e.accessories_requested?JSON.parse(e.accessories_requested):[];Array.isArray(t)&&(r=(o=t.map(e=>({product:(null==e?void 0:e.product)||"",brand:null==e?void 0:e.brand,price:parseFloat((null==e?void 0:e.price)||0),department:null==e?void 0:e.department}))).reduce((e,t)=>e+(t.price||0),0))}catch(e){}let i={id:e.vehicle_id||e.id,registration_number:e.registration_number,customer:{name:e.customer_name}};return{id:"vi_".concat(e.id),vehicle_id:e.vehicle_id||e.id,work_order_id:void 0,invoice_number:e.short_id||(null!=(t=e.registration_number)?t:"PENDING"),amount:r,tax_amount:0,total_amount:r,status:"installation_complete",due_date:void 0,paid_date:void 0,payment_method:void 0,description:"Installation complete - awaiting invoice",created_at:e.updated_at||e.created_at,updated_at:e.updated_at||e.created_at,vehicle:i,previewFromInward:e,previewProducts:o,work_order:void 0}});if(o.length>0){let e=o.map(e=>e.vehicle_id).filter(Boolean);if(e.length>0){let{data:t}=await this.supabase.from("vehicles").select("*, customer:customers(*)").in("id",e),r=new Map((null==t?void 0:t.map(e=>[e.id,e]))||[]);o.forEach(e=>{r.has(e.vehicle_id)&&(e.vehicle=r.get(e.vehicle_id))})}}let a=[...n,...o];return a.sort((e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime()),a.slice(0,e)}catch(e){throw console.error("Error fetching recent invoices:",e),e}}constructor(){this.supabase=(0,p.U)()}}let v=new f;var y=r(70408),b=r(65229),x=r(30599),_=r(85832);function w(e){let{vehicle:t,onClose:r,onStatusUpdate:n,canUpdateStatus:a,userRole:s}=e,[l,d]=(0,i.useState)(!1),[c,m]=(0,i.useState)(new Map),u=(0,p.U)();(0,i.useEffect)(()=>{(async()=>{try{let{data:e}=await u.from("departments").select("id, name");if(e){let t=new Map(e.map(e=>[e.id,e.name]));m(t)}}catch(e){console.error("Error loading departments:",e)}})()},[]);let h=async e=>{if(confirm("Update vehicle status to ".concat(e.replace("_"," "),"?"))){d(!0);try{let{error:o}=await u.from("vehicle_inward").update({status:e,updated_at:new Date().toISOString()}).eq("id",t.id);if(o)throw o;try{let{data:{user:r}}=await u.auth.getUser();r&&await x.w.createStatusUpdateNotification(r.id,t.id,e)}catch(e){console.error("Error creating notification:",e)}alert("Status updated successfully!"),n&&n(),r()}catch(e){console.error("Error updating status:",e),alert("Failed to update status")}finally{d(!1)}}},g=(e=>{switch(e.toLowerCase()){case"pending":return{label:"Pending",color:"#fef3c7",bgColor:"#92400e"};case"in_progress":return{label:"In Progress",color:"#dbeafe",bgColor:"#1e40af"};case"under_installation":case"under installation":return{label:"Under Installation",color:"#fbbf24",bgColor:"#d97706"};case"installation_complete":return{label:"Installation Complete",color:"#dcfce7",bgColor:"#166534"};case"complete_and_delivered":return{label:"Complete & Delivered",color:"#dcfce7",bgColor:"#166534"};default:return{label:e,color:"#f1f5f9",bgColor:"#64748b"}}})(t.status),f=(()=>{var e;let r=(null==(e=t.status)?void 0:e.toLowerCase().trim())||"";if("installer"===s){if("pending"===r||"pending "===r)return["in_progress"];if("in_progress"===r||"in progress"===r)return["under_installation"];if("under_installation"===r||"under installation"===r)return["installation_complete"]}return("coordinator"===s||"manager"===s||"admin"===s)&&"installation_complete"===r?["complete_and_delivered"]:[]})();return(0,o.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:(0,o.jsxs)("div",{style:{backgroundColor:"white",borderRadius:"1rem",width:"90%",maxWidth:"800px",maxHeight:"90vh",overflow:"auto",boxShadow:"0 20px 50px rgba(0,0,0,0.25)"},children:[(0,o.jsxs)("div",{style:{padding:"1.5rem",borderBottom:"1px solid #e5e7eb",display:"flex",justifyContent:"space-between",alignItems:"center",position:"sticky",top:0,backgroundColor:"white",zIndex:10},children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("h2",{style:{fontSize:"1.25rem",fontWeight:"600",color:"#111827",margin:0},children:"Vehicle Details"}),(0,o.jsx)("p",{style:{fontSize:"0.875rem",color:"#6b7280",margin:"0.25rem 0 0 0"},children:t.registration_number})]}),(0,o.jsx)("button",{onClick:r,style:{padding:"0.5rem",backgroundColor:"#f3f4f6",border:"none",borderRadius:"0.5rem",cursor:"pointer",display:"flex",alignItems:"center"},children:(0,o.jsx)(b.A,{style:{width:"1.25rem",height:"1.25rem",color:"#6b7280"}})})]}),(0,o.jsxs)("div",{style:{padding:"1.5rem"},children:[(0,o.jsxs)("div",{style:{marginBottom:"2rem"},children:[(0,o.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[(0,o.jsx)("h3",{style:{fontSize:"1rem",fontWeight:"600",color:"#111827"},children:"Current Status"}),(0,o.jsx)("span",{style:{padding:"0.5rem 1rem",borderRadius:"0.5rem",fontSize:"0.875rem",fontWeight:"600",backgroundColor:g.color,color:g.bgColor},children:g.label})]}),(0,o.jsx)("div",{style:{display:"flex",gap:"0.5rem"},children:["pending","in_progress","under_installation","installation_complete"].map((e,r)=>{var i,n;let a=["pending","in_progress","under_installation","installation_complete"].indexOf((null==(i=t.status)?void 0:i.toLowerCase())||""),s=(null==(n=t.status)?void 0:n.toLowerCase())===e;return(0,o.jsx)("div",{style:{flex:1,height:"0.5rem",backgroundColor:a>=r?"#059669":"#e5e7eb",borderRadius:"0.25rem",position:"relative",transition:"all 0.3s"},title:e.replace("_"," ").replace(/\b\w/g,e=>e.toUpperCase()),children:s&&(0,o.jsx)("div",{style:{position:"absolute",top:"-0.5rem",left:"50%",transform:"translateX(-50%)",width:"1rem",height:"1rem",backgroundColor:"#059669",borderRadius:"50%",border:"2px solid white",boxShadow:"0 0 0 2px #059669"}})},e)})}),(0,o.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"0.5rem",fontSize:"0.7rem",color:"#6b7280"},children:[(0,o.jsx)("span",{children:"Pending"}),(0,o.jsx)("span",{children:"In Progress"}),(0,o.jsx)("span",{children:"Under Installation"}),(0,o.jsx)("span",{children:"Complete"})]})]}),(0,o.jsxs)("div",{style:{marginBottom:"2rem"},children:[(0,o.jsx)("h3",{style:{fontSize:"1rem",fontWeight:"600",color:"#111827",marginBottom:"1rem"},children:"Vehicle Information"}),(0,o.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{style:{fontSize:"0.75rem",color:"#6b7280",marginBottom:"0.25rem"},children:"Make"}),(0,o.jsx)("div",{style:{fontWeight:"600",color:"#111827"},children:t.make})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{style:{fontSize:"0.75rem",color:"#6b7280",marginBottom:"0.25rem"},children:"Model"}),(0,o.jsx)("div",{style:{fontWeight:"600",color:"#111827"},children:t.model})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{style:{fontSize:"0.75rem",color:"#6b7280",marginBottom:"0.25rem"},children:"Registration"}),(0,o.jsx)("div",{style:{fontWeight:"600",color:"#111827"},children:t.registration_number})]}),t.year&&(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{style:{fontSize:"0.75rem",color:"#6b7280",marginBottom:"0.25rem"},children:"Year"}),(0,o.jsx)("div",{style:{fontWeight:"600",color:"#111827"},children:t.year})]}),t.color&&(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{style:{fontSize:"0.75rem",color:"#6b7280",marginBottom:"0.25rem"},children:"Color"}),(0,o.jsx)("div",{style:{fontWeight:"600",color:"#111827"},children:t.color})]})]})]}),t.customer&&(0,o.jsxs)("div",{style:{marginBottom:"2rem"},children:[(0,o.jsx)("h3",{style:{fontSize:"1rem",fontWeight:"600",color:"#111827",marginBottom:"1rem"},children:"Customer Information"}),(0,o.jsx)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{style:{fontSize:"0.75rem",color:"#6b7280",marginBottom:"0.25rem"},children:"Name"}),(0,o.jsx)("div",{style:{fontWeight:"600",color:"#111827"},children:t.customer.name})]})})]}),(t.issues_reported||t.accessories_requested)&&(0,o.jsxs)("div",{style:{marginBottom:"2rem"},children:[(0,o.jsx)("h3",{style:{fontSize:"1rem",fontWeight:"600",color:"#111827",marginBottom:"1rem"},children:"Work Details"}),t.issues_reported&&(0,o.jsxs)("div",{style:{marginBottom:"1rem"},children:[(0,o.jsx)("div",{style:{fontSize:"0.75rem",color:"#6b7280",marginBottom:"0.25rem"},children:"Issues Reported"}),(0,o.jsx)("div",{style:{backgroundColor:"#f9fafb",padding:"0.75rem",borderRadius:"0.5rem",fontSize:"0.875rem"},children:t.issues_reported})]}),t.accessories_requested&&(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{style:{fontSize:"0.75rem",color:"#6b7280",marginBottom:"0.25rem"},children:"Accessories Requested"}),(0,o.jsx)("div",{style:{backgroundColor:"#f9fafb",padding:"0.75rem",borderRadius:"0.5rem",fontSize:"0.875rem"},children:(()=>{try{let e=JSON.parse(t.accessories_requested||"[]");if(Array.isArray(e)&&e.length>0)return(0,o.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:e.map((t,r)=>(0,o.jsxs)("div",{style:{fontSize:"0.875rem",paddingBottom:r<e.length-1?"0.5rem":"0",borderBottom:r<e.length-1?"1px solid #e5e7eb":"none"},children:[(0,o.jsx)("strong",{children:t.product||"Product"}),t.brand&&(0,o.jsxs)("span",{children:[" - ",t.brand]}),t.department&&(0,o.jsxs)("span",{style:{color:"#6b7280",marginLeft:"0.5rem"},children:["(",c.get(t.department)||t.department,")"]})]},r))});return t.accessories_requested}catch(e){return t.accessories_requested}})()})]})]}),f.length>0&&(0,o.jsxs)("div",{style:{padding:"1.5rem",backgroundColor:"#eff6ff",borderRadius:"0.75rem",border:"2px solid #3b82f6",marginTop:"2rem"},children:[(0,o.jsx)("h3",{style:{fontSize:"1rem",fontWeight:"700",color:"#111827",marginBottom:"1rem"},children:"Update Status"}),(0,o.jsx)("div",{style:{display:"flex",gap:"0.75rem",flexWrap:"wrap"},children:f.map(e=>{let t="installation_complete"===e;return(0,o.jsx)("button",{onClick:()=>h(e),disabled:l,style:{padding:"1rem 2rem",backgroundColor:t?"#059669":"#2563eb",color:"white",border:"none",borderRadius:"0.5rem",fontSize:"1rem",fontWeight:"700",cursor:l?"not-allowed":"pointer",opacity:l?.5:1,transition:"all 0.2s",textTransform:"capitalize",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)",flex:1===f.length?"1":"none",minWidth:"200px"},onMouseEnter:e=>{l||(e.currentTarget.style.backgroundColor=t?"#047857":"#1d4ed8",e.currentTarget.style.transform="translateY(-2px)",e.currentTarget.style.boxShadow="0 10px 15px -3px rgba(0, 0, 0, 0.2)")},onMouseLeave:e=>{l||(e.currentTarget.style.backgroundColor=t?"#059669":"#2563eb",e.currentTarget.style.transform="translateY(0)",e.currentTarget.style.boxShadow="0 4px 6px -1px rgba(0, 0, 0, 0.1)")},children:l?"Updating...":"Mark as ".concat(e.replace("_"," "))},e)})})]}),(0,o.jsx)(_.A,{vehicleId:t.id,userRole:s})]})]})})}function j(){var e,t,r,f,b,x,_,j,S,C,k,z;let[I,B]=(0,i.useState)("overview"),[R,W]=(0,i.useState)(!0),[T,A]=(0,i.useState)(null),[N,D]=(0,i.useState)([]),[M,E]=(0,i.useState)([]),[P,L]=(0,i.useState)(null),[q,V]=(0,i.useState)(null),[U,O]=(0,i.useState)(new Map),[F,H]=(0,i.useState)(new Map),[Y,J]=(0,i.useState)(new Map),[K,G]=(0,i.useState)(new Map),X=(0,n.useRouter)(),Z=(0,p.U)(),[Q,$]=(0,i.useState)(null),[ee,et]=(0,i.useState)(!1);(0,i.useEffect)(()=>{ei(),eo(),er();let e=()=>et(window.innerWidth<=640);return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);let er=async()=>{try{let{data:e}=await Z.from("locations").select("id, name");if(e){let t=new Map(e.map(e=>[e.id,e.name]));O(t)}let{data:t}=await Z.from("vehicle_types").select("id, name");if(t){let e=new Map(t.map(e=>[e.id,e.name]));H(e)}let{data:r}=await Z.from("profiles").select("id, name").eq("role","manager");if(r){let e=new Map(r.map(e=>[e.id,e.name]));J(e)}let{data:o}=await Z.from("departments").select("id, name");if(o){let e=new Map(o.map(e=>[e.id,e.name]));G(e)}}catch(e){console.error("Error loading related data:",e)}},eo=async()=>{let e=await (0,y.MD)();e&&(L(e.role),("installer"===e.role||"coordinator"===e.role||"manager"===e.role)&&B("vehicles"),"accountant"===e.role&&B("invoices"))},ei=async()=>{try{W(!0);let[e,t,r]=await Promise.all([v.getDashboardKPIs(),v.getRecentVehicles(5),v.getRecentInvoices(5)]);A(e),D(t),E(r),await en()}catch(e){console.error("Error loading dashboard data:",e),A({vehiclesInWorkshop:12,jobsInProgress:8,todaysIntakes:5,unpaidInvoices:3,overduePayments:2,monthlyRevenue:24e4,vehiclesInWorkshopChange:2,jobsInProgressChange:1,todaysIntakesChange:3,unpaidInvoicesChange:-1,overduePaymentsChange:0,monthlyRevenueChange:15})}finally{W(!1)}},en=async()=>{try{let e=new Date().toISOString().split("T")[0],t=new Date().toISOString().substring(0,7),[r,o,i,n,a,s,l,d,c,m,u]=await Promise.all([Z.from("vehicle_inward").select("id",{count:"exact",head:!0}),Z.from("vehicle_inward").select("id",{count:"exact",head:!0}).in("status",["in_progress","under_installation"]),Z.from("vehicle_inward").select("id",{count:"exact",head:!0}).gte("created_at","".concat(e,"T00:00:00")).lte("created_at","".concat(e,"T23:59:59")),Z.from("invoices").select("id",{count:"exact",head:!0}),Z.from("invoices").select("total_amount").eq("status","paid").gte("paid_date","".concat(t,"-01")).lte("paid_date","".concat(t,"-31")),Z.from("vehicle_inward").select("final_amount,total_amount,discount_amount,accessories_requested,updated_at,created_at,status").in("status",["completed","complete_and_delivered"]),Z.from("vehicle_inward").select("id",{count:"exact",head:!0}).in("status",["installation_complete"]),Z.from("vehicle_inward").select("id",{count:"exact",head:!0}).in("status",["installation complete"]),Z.from("invoices").select("total_amount").eq("status","pending"),Z.from("invoices").select("total_amount").eq("status","paid").gte("paid_date","".concat(t,"-01")).lte("paid_date","".concat(t,"-31")),Z.from("invoices").select("total_amount").eq("status","overdue")]),h=(a.data||[]).reduce((e,t)=>e+(t.total_amount||0),0);!h&&s.data&&(h=s.data.filter(e=>{let r=new Date(e.updated_at||e.created_at);return"".concat(r.getFullYear(),"-").concat(String(r.getMonth()+1).padStart(2,"0"))===t}).reduce((e,t)=>{if(t.final_amount)return e+t.final_amount;if(t.total_amount)return e+t.total_amount;let r=0;try{let e=t.accessories_requested?JSON.parse(t.accessories_requested):[];Array.isArray(e)&&(r=e.reduce((e,t)=>e+parseFloat((null==t?void 0:t.price)||0),0))}catch(e){}return t.discount_amount&&(r-=Number(t.discount_amount)),e+(r||0)},0));let g=(c.data||[]).reduce((e,t)=>e+(t.total_amount||0),0),p=(m.data||[]).reduce((e,t)=>e+(t.total_amount||0),0),f=(u.data||[]).reduce((e,t)=>e+(t.total_amount||0),0);$({totalVehicles:r.count||0,jobsInProgress:o.count||0,todaysIntakes:i.count||0,recentInvoices:(n.count||0)+(l.count||0)+(d.count||0),monthlyRevenue:h,pendingAmount:g,paidThisMonth:p,overdueAmount:f})}catch(e){$(null)}},ea=e=>e>=1e5?"₹".concat((e/1e5).toFixed(1),"L"):"₹".concat(e.toLocaleString()),es=e=>e>0?"text-green-500":e<0?"text-red-500":"text-gray-500",el=e=>{switch(e.toLowerCase()){case"completed":case"installation_complete":case"installation complete":case"paid":return{bg:"#dcfce7",color:"#166534"};case"in_progress":case"in progress":return{bg:"#dbeafe",color:"#1e40af"};case"under_installation":case"under installation":return{bg:"#fef3c7",color:"#d97706"};case"pending":return{bg:"#fef3c7",color:"#92400e"};case"overdue":return{bg:"#fee2e2",color:"#dc2626"};case"in_workshop":return{bg:"#e0e7ff",color:"#3730a3"};default:return{bg:"#f1f5f9",color:"#64748b"}}},ed=async(e,t)=>{if(confirm("Update vehicle status to ".concat(t.replace("_"," "),"?")))try{let r=(0,p.U)(),{error:o}=await r.from("vehicle_inward").update({status:t,updated_at:new Date().toISOString()}).eq("id",e.id);if(o)throw o;alert("Status updated successfully!"),ei()}catch(e){console.error("Error updating status:",e),alert("Failed to update status")}};return R?(0,o.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,o.jsxs)("div",{className:"flex flex-col items-center space-y-4",children:[(0,o.jsx)(l.A,{className:"w-8 h-8 animate-spin text-blue-600"}),(0,o.jsx)("p",{className:"text-gray-600",children:"Loading dashboard..."})]})}):(0,o.jsxs)("div",{style:{backgroundColor:"#f9fafb",minHeight:"100vh",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},children:[(0,o.jsx)("div",{style:{backgroundColor:"white",borderBottom:"1px solid #e5e7eb",padding:ee?"1rem":"1.5rem 2rem"},children:(0,o.jsxs)("div",{style:{display:"flex",alignItems:ee?"flex-start":"center",justifyContent:"space-between",gap:ee?"0.75rem":"0",flexDirection:ee?"column":"row"},children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("h1",{style:{fontSize:ee?"1.5rem":"1.875rem",fontWeight:"700",color:"#111827",margin:"0 0 0.25rem 0"},children:"Dashboard"}),(0,o.jsx)("p",{style:{fontSize:"0.875rem",color:"#6b7280",margin:0},children:"Track your business performance"})]}),(0,o.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",width:ee?"100%":"auto"},children:[(0,o.jsxs)("button",{onClick:ei,style:{display:"flex",width:ee?"100%":"auto",justifyContent:"center",alignItems:"center",gap:"0.5rem",padding:ee?"0.5rem 1rem":"0.625rem 1.25rem",backgroundColor:"#f3f4f6",color:"#374151",border:"1px solid #e5e7eb",borderRadius:"0.625rem",fontSize:"0.875rem",fontWeight:"500",cursor:"pointer",transition:"all 0.2s"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#e5e7eb"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="#f3f4f6"},children:[(0,o.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,o.jsx)("path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"}),(0,o.jsx)("path",{d:"M21 3v5h-5"}),(0,o.jsx)("path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"}),(0,o.jsx)("path",{d:"M3 21v-5h5"})]}),"Refresh"]}),!ee&&("admin"===P||"manager"===P||"coordinator"===P)&&(0,o.jsxs)("button",{onClick:()=>X.push("/inward/new"),style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.625rem 1.5rem",backgroundColor:"#3b82f6",color:"white",border:"none",borderRadius:"0.625rem",fontSize:"0.875rem",fontWeight:"600",cursor:"pointer",boxShadow:"0 4px 6px -1px rgba(59, 130, 246, 0.3)",transition:"all 0.2s"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#2563eb",e.currentTarget.style.boxShadow="0 6px 8px -1px rgba(59, 130, 246, 0.4)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="#3b82f6",e.currentTarget.style.boxShadow="0 4px 6px -1px rgba(59, 130, 246, 0.3)"},children:[(0,o.jsx)(d.A,{style:{width:"1rem",height:"1rem"}}),"Add Vehicle"]})]})]})}),(0,o.jsx)("div",{style:{backgroundColor:"white",borderBottom:"1px solid #e5e7eb",padding:ee?"0 1rem":"0 2rem",display:"flex",gap:"0"},children:(0,o.jsx)("div",{style:{display:"flex",gap:"2rem"},children:("installer"===P||"coordinator"===P?[{id:"vehicles",label:"Recent Vehicles"}]:"manager"===P?[{id:"vehicles",label:"Recent Vehicles"},{id:"invoices",label:"Recent Invoices"}]:"accountant"===P?[{id:"invoices",label:"Recent Invoices"}]:[{id:"overview",label:"Overview"},{id:"vehicles",label:"Recent Vehicles"},{id:"invoices",label:"Recent Invoices"}]).map(e=>(0,o.jsx)("button",{onClick:()=>B(e.id),style:{padding:"0.875rem 1rem 0.875rem 0",border:"none",backgroundColor:"transparent",color:I===e.id?"#3b82f6":"#6b7280",fontWeight:I===e.id?"600":"500",borderBottom:I===e.id?"2px solid #3b82f6":"2px solid transparent",cursor:"pointer",fontSize:"0.875rem",transition:"all 0.2s",position:"relative"},onMouseEnter:t=>{I!==e.id&&(t.currentTarget.style.color="#374151")},onMouseLeave:t=>{I!==e.id&&(t.currentTarget.style.color="#6b7280")},children:e.label},e.id))})}),q&&(0,o.jsx)(w,{vehicle:q,onClose:()=>V(null),onStatusUpdate:()=>{ei()},canUpdateStatus:!0,userRole:P||"coordinator"}),(0,o.jsxs)("div",{style:{padding:ee?"1rem":"2rem"},children:["overview"===I&&"installer"!==P&&"coordinator"!==P&&(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(240px, 1fr))",gap:"1.25rem",marginBottom:"2rem"},children:[1].map(()=>null)&&[{title:"Total Vehicles",value:(null!=(e=null==Q?void 0:Q.totalVehicles)?e:((null==T?void 0:T.vehiclesInWorkshop)||0)+((null==T?void 0:T.jobsInProgress)||0)+((null==T?void 0:T.todaysIntakes)||0)).toString(),icon:c.A,change:"",color:"#2563eb",changeValue:0},{title:"Jobs in Progress",value:(null!=(r=null!=(t=null==Q?void 0:Q.jobsInProgress)?t:null==T?void 0:T.jobsInProgress)?r:0).toString(),icon:m.A,change:"",color:"#059669",changeValue:0},{title:"Today's Intakes",value:(null!=(b=null!=(f=null==Q?void 0:Q.todaysIntakes)?f:null==T?void 0:T.todaysIntakes)?b:0).toString(),icon:u.A,change:"",color:"#7c3aed",changeValue:0},{title:"Recent Invoices",value:(null!=(x=null==Q?void 0:Q.recentInvoices)?x:M.length).toString(),icon:h.A,change:"",color:"#2563eb",changeValue:0},{title:"Monthly Revenue",value:ea(null!=(j=null!=(_=null==Q?void 0:Q.monthlyRevenue)?_:null==T?void 0:T.monthlyRevenue)?j:0),icon:g.A,change:"",color:"#059669",changeValue:0}].map((e,t)=>{var r;return(0,o.jsxs)("div",{style:{backgroundColor:"white",padding:"1.5rem",borderRadius:"0.875rem",border:"1px solid #e5e7eb",cursor:"pointer",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",boxShadow:"0 1px 3px rgba(0,0,0,0.05)",position:"relative",overflow:"hidden"},onClick:()=>alert("".concat(e.title,": ").concat(e.value)),onMouseEnter:t=>{t.currentTarget.style.transform="translateY(-4px)",t.currentTarget.style.boxShadow="0 12px 24px -8px rgba(0,0,0,0.15)",t.currentTarget.style.borderColor=e.color},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0)",e.currentTarget.style.boxShadow="0 1px 3px rgba(0,0,0,0.05)",e.currentTarget.style.borderColor="#e5e7eb"},children:[(0,o.jsx)("div",{style:{position:"absolute",top:0,right:0,width:"100%",height:"4px",background:"linear-gradient(90deg, transparent, ".concat(e.color,"20)"),borderTopLeftRadius:"0.875rem",borderTopRightRadius:"0.875rem"}}),(0,o.jsxs)("div",{style:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",marginBottom:"1rem"},children:[(0,o.jsx)("div",{style:{padding:"0.75rem",backgroundColor:"".concat(e.color,"15"),borderRadius:"0.75rem",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,o.jsx)(e.icon,{style:{color:e.color,width:"1.5rem",height:"1.5rem"},strokeWidth:2})}),(0,o.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem",padding:"0.25rem 0.5rem",backgroundColor:es(e.changeValue)+"15",borderRadius:"0.5rem"},children:[(r=e.changeValue)>0?(0,o.jsx)(a.A,{className:"w-3 h-3 text-green-500"}):r<0?(0,o.jsx)(s,{className:"w-3 h-3 text-red-500"}):null,(0,o.jsx)("span",{style:{fontSize:"0.75rem",color:es(e.changeValue),fontWeight:"600"},children:e.change})]})]}),(0,o.jsx)("div",{style:{fontSize:"2rem",fontWeight:"700",color:"#111827",marginBottom:"0.375rem",lineHeight:"1.2"},children:e.value}),(0,o.jsx)("div",{style:{fontSize:"0.875rem",color:"#6b7280",fontWeight:"500"},children:e.title})]},t)})}),(0,o.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(320px, 1fr))",gap:"1.25rem",marginBottom:"2rem"},children:[(0,o.jsxs)("div",{style:{backgroundColor:"white",border:"1px solid #e5e7eb",borderRadius:"0.875rem",padding:"1.25rem"},children:[(0,o.jsx)("div",{style:{fontSize:"1rem",fontWeight:700,color:"#111827",marginBottom:"0.75rem"},children:"Operations Snapshot"}),(0,o.jsx)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"0.75rem"},children:["pending","in_progress","under_installation","installation_complete","completed","delivered"].map(e=>{let t=N.filter(t=>(t.status||"").toLowerCase().trim()===e).length;return(0,o.jsxs)("div",{style:{border:"1px solid #e5e7eb",borderRadius:"0.5rem",padding:"0.75rem"},children:[(0,o.jsx)("div",{style:{fontSize:"0.75rem",color:"#6b7280",marginBottom:"0.25rem",textTransform:"capitalize"},children:e.replace("_"," ")}),(0,o.jsx)("div",{style:{fontSize:"1.25rem",fontWeight:700,color:"#111827"},children:t})]},e)})})]}),(0,o.jsxs)("div",{style:{backgroundColor:"white",border:"1px solid #e5e7eb",borderRadius:"0.875rem",padding:"1.25rem"},children:[(0,o.jsx)("div",{style:{fontSize:"1rem",fontWeight:700,color:"#111827",marginBottom:"0.75rem"},children:"Finance Snapshot"}),(0,o.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"0.75rem"},children:[(0,o.jsxs)("div",{style:{border:"1px solid #e5e7eb",borderRadius:"0.5rem",padding:"0.75rem"},children:[(0,o.jsx)("div",{style:{fontSize:"0.75rem",color:"#6b7280",marginBottom:"0.25rem"},children:"Recent Invoices"}),(0,o.jsx)("div",{style:{fontSize:"1.25rem",fontWeight:700,color:"#111827"},children:null!=(S=null==Q?void 0:Q.recentInvoices)?S:M.length})]}),(0,o.jsxs)("div",{style:{border:"1px solid #e5e7eb",borderRadius:"0.5rem",padding:"0.75rem"},children:[(0,o.jsx)("div",{style:{fontSize:"0.75rem",color:"#6b7280",marginBottom:"0.25rem"},children:"Pending Amount"}),(0,o.jsx)("div",{style:{fontSize:"1.25rem",fontWeight:700,color:"#111827"},children:ea(null!=(C=null==Q?void 0:Q.pendingAmount)?C:0)})]}),(0,o.jsxs)("div",{style:{border:"1px solid #e5e7eb",borderRadius:"0.5rem",padding:"0.75rem"},children:[(0,o.jsx)("div",{style:{fontSize:"0.75rem",color:"#6b7280",marginBottom:"0.25rem"},children:"Paid This Month"}),(0,o.jsx)("div",{style:{fontSize:"1.25rem",fontWeight:700,color:"#111827"},children:ea(null!=(k=null==Q?void 0:Q.paidThisMonth)?k:0)})]}),(0,o.jsxs)("div",{style:{border:"1px solid #e5e7eb",borderRadius:"0.5rem",padding:"0.75rem"},children:[(0,o.jsx)("div",{style:{fontSize:"0.75rem",color:"#6b7280",marginBottom:"0.25rem"},children:"Overdue"}),(0,o.jsx)("div",{style:{fontSize:"1.25rem",fontWeight:700,color:"#111827"},children:ea(null!=(z=null==Q?void 0:Q.overdueAmount)?z:0)})]})]})]})]}),(0,o.jsxs)("div",{style:{backgroundColor:"white",border:"1px solid #e5e7eb",borderRadius:"0.875rem",padding:"1.25rem",marginBottom:"2rem"},children:[(0,o.jsx)("div",{style:{fontSize:"1rem",fontWeight:700,color:"#111827",marginBottom:"0.75rem"},children:"In Progress by Location"}),(0,o.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))",gap:"0.75rem"},children:[Array.from(N.reduce((e,t)=>{let r=(t.status||"").toLowerCase().trim();if("in_progress"===r||"under_installation"===r){let r=t.location_id||t.location||"N/A";e.set(r,(e.get(r)||0)+1)}return e},new Map).entries()).map(e=>{let[t,r]=e;return(0,o.jsxs)("div",{style:{border:"1px solid #e5e7eb",borderRadius:"0.5rem",padding:"0.75rem"},children:[(0,o.jsx)("div",{style:{fontSize:"0.875rem",color:"#6b7280",marginBottom:"0.25rem"},children:U.get(t)||t}),(0,o.jsx)("div",{style:{fontSize:"1.25rem",fontWeight:700,color:"#111827"},children:r})]},t)}),0===N.length&&(0,o.jsx)("div",{style:{color:"#6b7280",fontSize:"0.875rem"},children:"No data available"})]})]}),(0,o.jsxs)("div",{style:{backgroundColor:"white",border:"1px solid #e5e7eb",borderRadius:"0.875rem",padding:"1.25rem",marginTop:"1.25rem"},children:[(0,o.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.75rem"},children:[(0,o.jsx)("div",{style:{fontSize:"1rem",fontWeight:700,color:"#111827"},children:"Recent Activity"}),(0,o.jsx)("button",{onClick:ei,style:{border:"1px solid #e5e7eb",background:"white",padding:"0.375rem 0.75rem",borderRadius:"0.375rem",cursor:"pointer",fontSize:"0.75rem"},children:"Refresh"})]}),(0,o.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(280px, 1fr))",gap:"0.75rem"},children:[N.slice(0,6).map(e=>{var t;return(0,o.jsxs)("div",{style:{border:"1px solid #e5e7eb",borderRadius:"0.5rem",padding:"0.75rem"},children:[(0,o.jsx)("div",{style:{fontWeight:600,color:"#111827",marginBottom:"0.25rem"},children:(null==(t=e.customer)?void 0:t.name)||e.registration_number}),(0,o.jsxs)("div",{style:{fontSize:"0.75rem",color:"#6b7280"},children:[(e.status||"").replace("_"," ").toUpperCase()," • ",new Date(e.updated_at||e.created_at).toLocaleDateString("en-IN")]})]},e.id)}),M.slice(0,6).map(e=>(0,o.jsxs)("div",{style:{border:"1px solid #e5e7eb",borderRadius:"0.5rem",padding:"0.75rem"},children:[(0,o.jsxs)("div",{style:{fontWeight:600,color:"#111827",marginBottom:"0.25rem"},children:["Invoice ",e.invoice_number]}),(0,o.jsxs)("div",{style:{fontSize:"0.75rem",color:"#6b7280"},children:[ea(e.total_amount)," • ",(e.status||"").toUpperCase()]})]},e.id))]})]})]}),"vehicles"===I&&(0,o.jsxs)("div",{style:{display:"grid",gridTemplateColumns:ee?"1fr":"repeat(auto-fill, minmax(380px, 1fr))",gap:ee?"1rem":"1.5rem"},children:[N.filter(e=>{var t;let r=(null==(t=e.status)?void 0:t.toLowerCase().trim())||"";if(["delivered","complete_and_delivered"].includes(r))return!1;if("installer"===P)return"pending"===r||"in_progress"===r||"in progress"===r||"under_installation"===r||"under installation"===r;if("installation_complete"===r||"installation complete"===r){let t=e.updated_at||e.created_at;if(t){let e=new Date(t),r=new Date;if(r.setHours(r.getHours()-24),e<r)return!1}}return!0}).map(e=>{var t,r,i;let n=el(e.status);return(0,o.jsxs)("div",{style:{backgroundColor:"white",borderRadius:"0.75rem",border:"1px solid #e2e8f0",overflow:"hidden",transition:"all 0.3s",boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},onMouseEnter:e=>{e.currentTarget.style.transform="translateY(-4px)",e.currentTarget.style.boxShadow="0 10px 25px rgba(0,0,0,0.15)"},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0)",e.currentTarget.style.boxShadow="0 1px 3px rgba(0,0,0,0.1)"},children:[(0,o.jsxs)("div",{style:{padding:"1.25rem",backgroundColor:"#f8fafc",borderBottom:"1px solid #e2e8f0",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{style:{fontSize:"1.125rem",fontWeight:"700",color:"#111827",marginBottom:"0.25rem"},children:(null==(t=e.customer)?void 0:t.name)||"N/A"}),(0,o.jsx)("div",{style:{fontSize:"0.875rem",color:"#6b7280"},children:e.registration_number})]}),(0,o.jsx)("span",{style:{padding:"0.375rem 0.875rem",borderRadius:"9999px",fontSize:"0.75rem",fontWeight:"600",backgroundColor:n.bg,color:n.color},children:e.status.replace("_"," ").toUpperCase()})]}),(0,o.jsxs)("div",{style:{padding:ee?"1rem":"1.25rem"},children:[(0,o.jsxs)("div",{style:{display:"grid",gridTemplateColumns:ee?"1fr":"repeat(2, 1fr)",gap:ee?"0.75rem":"1rem",marginBottom:"1.25rem"},children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{style:{fontSize:"0.75rem",color:"#6b7280",marginBottom:"0.375rem"},children:"Inward Date & Time"}),(0,o.jsxs)("div",{style:{fontSize:"0.875rem",fontWeight:"600",color:"#111827"},children:[new Date(e.created_at).toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric"})," ",new Date(e.created_at).toLocaleTimeString("en-IN",{hour:"2-digit",minute:"2-digit"})]})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{style:{fontSize:"0.75rem",color:"#6b7280",marginBottom:"0.375rem"},children:"Owner Name"}),(0,o.jsx)("div",{style:{fontSize:"0.875rem",fontWeight:"600",color:"#111827"},children:(null==(r=e.customer)?void 0:r.name)||"N/A"})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{style:{fontSize:"0.75rem",color:"#6b7280",marginBottom:"0.375rem"},children:"Model"}),(0,o.jsxs)("div",{style:{fontSize:"0.875rem",fontWeight:"600",color:"#111827"},children:[e.make," ",e.model]})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{style:{fontSize:"0.75rem",color:"#6b7280",marginBottom:"0.375rem"},children:"Car Number"}),(0,o.jsx)("div",{style:{fontSize:"0.875rem",fontWeight:"600",color:"#111827"},children:e.registration_number})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{style:{fontSize:"0.75rem",color:"#6b7280",marginBottom:"0.375rem"},children:"Location"}),(0,o.jsx)("div",{style:{fontSize:"0.875rem",fontWeight:"600",color:"#111827"},children:e.location_id&&U.get(e.location_id)||e.location_id||"N/A"})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{style:{fontSize:"0.75rem",color:"#6b7280",marginBottom:"0.375rem"},children:"Vehicle Type"}),(0,o.jsx)("div",{style:{fontSize:"0.875rem",fontWeight:"600",color:"#111827"},children:e.vehicle_type&&F.get(e.vehicle_type)||e.vehicle_type||"N/A"})]}),e.assigned_manager_id&&(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{style:{fontSize:"0.75rem",color:"#6b7280",marginBottom:"0.375rem"},children:"Manager"}),(0,o.jsx)("div",{style:{fontSize:"0.875rem",fontWeight:"600",color:"#111827"},children:Y.get(e.assigned_manager_id)||e.assigned_manager_id||"N/A"})]}),e.estimated_completion_date&&(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{style:{fontSize:"0.75rem",color:"#6b7280",marginBottom:"0.375rem"},children:"Expected Date"}),(0,o.jsx)("div",{style:{fontSize:"0.875rem",fontWeight:"600",color:"#111827"},children:new Date(e.estimated_completion_date).toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric"})})]})]}),(0,o.jsxs)("div",{style:{marginBottom:"1.25rem",padding:"1rem",backgroundColor:"#f9fafb",borderRadius:"0.5rem"},children:[(0,o.jsx)("div",{style:{fontSize:"0.75rem",color:"#6b7280",marginBottom:"0.375rem"},children:"Product Details"}),(0,o.jsx)("div",{style:{fontSize:"0.875rem",color:"#111827"},children:(()=>{let t=e.accessories_requested;if(!t)return e.issues_reported||"No details provided";try{let e=JSON.parse(t);if(Array.isArray(e)&&e.length>0)return(0,o.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:e.map((e,t)=>(0,o.jsxs)("div",{style:{fontSize:"0.8125rem"},children:[(0,o.jsx)("strong",{children:e.product||"Product"}),e.brand&&" - ".concat(e.brand),e.department&&(0,o.jsxs)("span",{style:{color:"#6b7280",marginLeft:"0.5rem"},children:["(",K.get(e.department)||e.department,")"]})]},t))});return t}catch(e){return t}})()})]}),(()=>{var t;let r=(null==(t=e.status)?void 0:t.toLowerCase().trim())||"",i=["delivered","complete_and_delivered"].includes(r),n="completed"===r,a="installation_complete"===r||"installation complete"===r;return i||n||a?(0,o.jsxs)("div",{style:{padding:"1rem",backgroundColor:"#f3f4f6",borderRadius:"0.5rem",border:"1px solid #e5e7eb",marginBottom:"0.5rem",textAlign:"center"},children:[(0,o.jsxs)("div",{style:{fontSize:"0.875rem",fontWeight:"600",color:"#6b7280",marginBottom:"0.25rem"},children:["Status ",i?"(Final - No Updates)":a?"(Moved to Accounts - No Updates)":"(No Updates in Recent Vehicles)"]}),(0,o.jsx)("div",{style:{fontSize:"0.875rem",color:"#374151",fontStyle:"italic"},children:e.status.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")})]}):(0,o.jsxs)("div",{style:{padding:"1rem",backgroundColor:"#f9fafb",borderRadius:"0.5rem",border:"1px solid #e5e7eb",marginBottom:"0.5rem"},children:[(0,o.jsx)("div",{style:{fontSize:"0.875rem",fontWeight:"600",color:"#111827",marginBottom:"0.5rem"},children:"Update Status"}),(0,o.jsxs)("select",{value:e.status||"pending",onChange:t=>{t.stopPropagation();let r=t.target.value;r!==e.status&&ed(e,r)},style:{width:"100%",padding:"0.75rem",fontSize:"0.875rem",border:"1px solid #d1d5db",borderRadius:"0.5rem",backgroundColor:"white",color:"#111827",cursor:"pointer",outline:"none"},onMouseEnter:e=>{e.currentTarget.style.borderColor="#3b82f6",e.currentTarget.style.boxShadow="0 0 0 3px rgba(59, 130, 246, 0.1)"},onMouseLeave:e=>{e.currentTarget.style.borderColor="#d1d5db",e.currentTarget.style.boxShadow="none"},children:[(0,o.jsx)("option",{value:"pending",children:"Pending"}),(0,o.jsx)("option",{value:"in_progress",children:"In Progress"}),(0,o.jsx)("option",{value:"under_installation",children:"Under Installation"}),(0,o.jsx)("option",{value:"installation_complete",children:"Installation Complete"})]})]})})(),["completed","delivered","complete_and_delivered","installation_complete","installation complete"].includes((null==(i=e.status)?void 0:i.toLowerCase().trim())||"")?null:(0,o.jsx)("button",{onClick:()=>{V(e)},style:{width:"100%",padding:"0.75rem 1.5rem",backgroundColor:"#2563eb",color:"white",border:"none",borderRadius:"0.5rem",fontSize:"0.875rem",fontWeight:"600",cursor:"pointer",transition:"all 0.2s",marginTop:"installer"===P?"0.5rem":"0"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#1d4ed8"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="#2563eb"},children:"View Full Details"})]})]},e.id)}),0===N.filter(e=>{var t;let r=(null==(t=e.status)?void 0:t.toLowerCase().trim())||"";if(["delivered","complete_and_delivered"].includes(r))return!1;if("installer"===P)return"pending"===r||"in_progress"===r||"in progress"===r||"under_installation"===r||"under installation"===r;if("installation_complete"===r||"installation complete"===r){let t=e.updated_at||e.created_at;if(t){let e=new Date(t),r=new Date;if(r.setHours(r.getHours()-24),e<r)return!1}}return!0}).length&&(0,o.jsxs)("div",{style:{gridColumn:"1 / -1",backgroundColor:"white",borderRadius:"0.75rem",border:"1px solid #e2e8f0",padding:"3rem",textAlign:"center"},children:[(0,o.jsx)("div",{style:{fontSize:"1.125rem",fontWeight:"600",color:"#6b7280",marginBottom:"0.5rem"},children:"No vehicles found"}),(0,o.jsx)("div",{style:{fontSize:"0.875rem",color:"#9ca3af"},children:"installer"===P?"You have no vehicles assigned at the moment.":"No recent vehicles found."})]})]}),"invoices"===I&&(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"1rem"},children:(0,o.jsx)("h3",{style:{fontSize:"1.125rem",fontWeight:"600",color:"#1e293b",margin:0},children:"Recent Invoices"})}),(0,o.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(400px, 1fr))",gap:"1.5rem"},children:[M.map(e=>{var t,r,i,n,a;let s=el(e.status),l=e.previewFromInward,d=e.previewProducts;return(0,o.jsxs)("div",{style:{backgroundColor:"white",borderRadius:"0.75rem",border:"1px solid #e2e8f0",overflow:"hidden",transition:"all 0.3s",boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:[(0,o.jsxs)("div",{style:{padding:"1.25rem",backgroundColor:"#f8fafc",borderBottom:"1px solid #e2e8f0",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{style:{fontSize:"1.125rem",fontWeight:"700",color:"#111827",marginBottom:"0.25rem"},children:(null==(r=e.vehicle)||null==(t=r.customer)?void 0:t.name)||(null==l?void 0:l.customer_name)||"N/A"}),(0,o.jsx)("div",{style:{fontSize:"0.875rem",color:"#6b7280"},children:e.invoice_number})]}),(0,o.jsx)("span",{style:{padding:"0.375rem 0.875rem",borderRadius:"9999px",fontSize:"0.75rem",fontWeight:"600",backgroundColor:s.bg,color:s.color},children:e.status.replace("_"," ").toUpperCase()})]}),(0,o.jsxs)("div",{style:{padding:"1.25rem"},children:[(0,o.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"1rem",marginBottom:"1.25rem"},children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{style:{fontSize:"0.75rem",color:"#6b7280",marginBottom:"0.375rem"},children:"Customer"}),(0,o.jsx)("div",{style:{fontSize:"0.875rem",fontWeight:"600",color:"#111827"},children:(null==(n=e.vehicle)||null==(i=n.customer)?void 0:i.name)||(null==l?void 0:l.customer_name)||"N/A"})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{style:{fontSize:"0.75rem",color:"#6b7280",marginBottom:"0.375rem"},children:"Vehicle Number"}),(0,o.jsx)("div",{style:{fontSize:"0.875rem",fontWeight:"600",color:"#111827"},children:(null==(a=e.vehicle)?void 0:a.registration_number)||(null==l?void 0:l.registration_number)||"N/A"})]}),l&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{style:{fontSize:"0.75rem",color:"#6b7280",marginBottom:"0.375rem"},children:"Model"}),(0,o.jsx)("div",{style:{fontSize:"0.875rem",fontWeight:"600",color:"#111827"},children:(l.make||"")+(l.model?" ".concat(l.model):"")||"N/A"})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{style:{fontSize:"0.75rem",color:"#6b7280",marginBottom:"0.375rem"},children:"Location"}),(0,o.jsx)("div",{style:{fontSize:"0.875rem",fontWeight:"600",color:"#111827"},children:l.location_id?U.get(l.location_id)||l.location_id:"N/A"})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{style:{fontSize:"0.75rem",color:"#6b7280",marginBottom:"0.375rem"},children:"Vehicle Type"}),(0,o.jsx)("div",{style:{fontSize:"0.875rem",fontWeight:"600",color:"#111827"},children:l.vehicle_type?F.get(l.vehicle_type)||l.vehicle_type:"N/A"})]}),l.assigned_manager_id&&(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{style:{fontSize:"0.75rem",color:"#6b7280",marginBottom:"0.375rem"},children:"Manager"}),(0,o.jsx)("div",{style:{fontSize:"0.875rem",fontWeight:"600",color:"#111827"},children:Y.get(l.assigned_manager_id)||l.assigned_manager_id})]}),l.estimated_completion_date&&(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{style:{fontSize:"0.75rem",color:"#6b7280",marginBottom:"0.375rem"},children:"Expected Date"}),(0,o.jsx)("div",{style:{fontSize:"0.875rem",fontWeight:"600",color:"#111827"},children:new Date(l.estimated_completion_date).toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric"})})]})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{style:{fontSize:"0.75rem",color:"#6b7280",marginBottom:"0.375rem"},children:"Amount"}),(0,o.jsx)("div",{style:{fontSize:"0.875rem",fontWeight:"700",color:"#111827"},children:ea(e.total_amount)})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{style:{fontSize:"0.75rem",color:"#6b7280",marginBottom:"0.375rem"},children:"Date"}),(0,o.jsx)("div",{style:{fontSize:"0.875rem",fontWeight:"600",color:"#111827"},children:new Date(e.created_at).toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric"})})]})]}),d&&d.length>0&&(0,o.jsxs)("div",{style:{marginTop:"0.5rem",padding:"1rem",backgroundColor:"#f9fafb",borderRadius:"0.5rem"},children:[(0,o.jsx)("div",{style:{fontSize:"0.75rem",color:"#6b7280",marginBottom:"0.375rem"},children:"Product Details"}),(0,o.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:d.map((e,t)=>(0,o.jsxs)("div",{style:{fontSize:"0.8125rem",color:"#111827"},children:[(0,o.jsx)("strong",{children:e.product||"Product"}),e.brand&&" - ".concat(e.brand),e.department&&(0,o.jsxs)("span",{style:{color:"#6b7280",marginLeft:"0.5rem"},children:["(",K.get(e.department)||e.department,")"]}),(0,o.jsx)("span",{style:{float:"right",fontWeight:600},children:ea(e.price||0)})]},t))})]})]})]},e.id)}),0===M.length&&(0,o.jsxs)("div",{style:{gridColumn:"1 / -1",backgroundColor:"white",borderRadius:"0.75rem",border:"1px solid #e2e8f0",padding:"3rem",textAlign:"center"},children:[(0,o.jsx)("div",{style:{fontSize:"1.125rem",fontWeight:"600",color:"#6b7280",marginBottom:"0.5rem"},children:"No invoices to show"}),(0,o.jsx)("div",{style:{fontSize:"0.875rem",color:"#9ca3af"},children:"Invoices from the external system and invoice-ready entries will appear here."})]})]})]})]})]})}},20063:(e,t,r)=>{"use strict";var o=r(47260);r.o(o,"useParams")&&r.d(t,{useParams:function(){return o.useParams}}),r.o(o,"usePathname")&&r.d(t,{usePathname:function(){return o.usePathname}}),r.o(o,"useRouter")&&r.d(t,{useRouter:function(){return o.useRouter}}),r.o(o,"useSearchParams")&&r.d(t,{useSearchParams:function(){return o.useSearchParams}})},30599:(e,t,r)=>{"use strict";r.d(t,{w:()=>n});var o=r(8525);class i{async getUserNotifications(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{let r=this.supabase.from("notifications").select("*").eq("user_id",e).order("created_at",{ascending:!1}).limit(50);t&&(r=r.eq("read",!1));let{data:o,error:i}=await r;if(i)throw i;return o||[]}catch(e){return console.error("Error fetching notifications:",e),[]}}async getUnreadCount(e){try{let{count:t,error:r}=await this.supabase.from("notifications").select("*",{count:"exact",head:!0}).eq("user_id",e).eq("read",!1);if(r)throw r;return t||0}catch(e){return console.error("Error fetching unread count:",e),0}}async markAsRead(e){try{let{error:t}=await this.supabase.from("notifications").update({read:!0}).eq("id",e);if(t)throw t}catch(e){throw console.error("Error marking notification as read:",e),e}}async markAllAsRead(e){try{let{error:t}=await this.supabase.from("notifications").update({read:!0}).eq("user_id",e).eq("read",!1);if(t)throw t}catch(e){throw console.error("Error marking all as read:",e),e}}async createNotification(e){try{let{data:t,error:r}=await this.supabase.from("notifications").insert(e).select().single();if(r)throw r;return t}catch(e){throw console.error("Error creating notification:",e),e}}async deleteNotification(e){try{let{error:t}=await this.supabase.from("notifications").delete().eq("id",e);if(t)throw t}catch(e){throw console.error("Error deleting notification:",e),e}}async createBackupReminder(e){let t=new Date;t.setDate(t.getDate()-1),await this.createNotification({user_id:e,title:"Backup Reminder",message:"It's time to backup your database. Last backup was on "+t.toLocaleDateString(),type:"reminder",read:!1,priority:2,action_url:"/settings"})}async createVehicleAssignmentNotification(e,t){await this.createNotification({user_id:e,title:"New Vehicle Assignment",message:"Vehicle ".concat(t.registration_number," has been assigned to you for ").concat(t.accessories_requested||"installation"),type:"info",read:!1,priority:1,action_url:"/dashboard"})}async createStatusUpdateNotification(e,t,r){await this.createNotification({user_id:e,title:"Vehicle Status Updated",message:"Vehicle status has been updated to ".concat(r.replace("_"," ")),type:"info",read:!1,priority:0,action_url:"/dashboard"})}async createOverduePaymentNotification(e,t,r){await this.createNotification({user_id:e,title:"Overdue Payment",message:"Payment overdue: ₹".concat(r.toLocaleString()," for invoice ").concat(t),type:"warning",read:!1,priority:2,action_url:"/accounts/invoices"})}constructor(){this.supabase=(0,o.U)()}}let n=new i},41082:(e,t,r)=>{Promise.resolve().then(r.bind(r,18517))},53842:(e,t,r)=>{"use strict";r.d(t,{A:()=>o});let o=(0,r(45105).A)("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]])},70408:(e,t,r)=>{"use strict";r.d(t,{MD:()=>i,hZ:()=>n}),r(20063),r(88727);var o=r(8525);async function i(){let e=(0,o.U)(),{data:{user:t}}=await e.auth.getUser();if(!t)return null;let{data:r,error:i}=await e.from("profiles").select("*").eq("id",t.id).single();return i||!r?null:r}function n(e){return[{title:"Dashboard",href:"/dashboard",icon:"LayoutDashboard",roles:["admin","manager","coordinator","installer","accountant"]},{title:"Vehicle Inward",href:"/inward/new",icon:"Car",roles:["admin","manager","coordinator"]},{title:"Vehicle Management",href:"/vehicles",icon:"Truck",roles:["admin","manager","coordinator"]},{title:"Trackers",href:"/trackers",icon:"Activity",roles:["admin","manager","coordinator"]},{title:"Accounts",href:"/accounts",icon:"DollarSign",roles:["admin","accountant"],children:[{title:"Invoices",href:"/accounts/invoices",icon:"FileText",roles:["admin","accountant"]},{title:"Reports",href:"/accounts/reports",icon:"BarChart3",roles:["admin","accountant"]}]},{title:"Settings",href:"/settings",icon:"Settings",roles:["admin","manager","installer","coordinator","accountant"]},{title:"About",href:"/about",icon:"Settings",roles:["admin","manager","installer","coordinator","accountant"]}].filter(t=>{if(Array.isArray(t.children)){let r=t.children.filter(t=>t.roles.includes(e));return t.roles.includes(e)&&r.length>0}return t.roles.includes(e)})}}},e=>{e.O(0,[331,762,441,255,358],()=>e(e.s=41082)),_N_E=e.O()}]);