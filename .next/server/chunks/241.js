"use strict";exports.id=241,exports.ids=[241],exports.modules={3663:(a,b,c)=>{c.d(b,{A:()=>d});let d=(0,c(28731).A)("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]])},40284:(a,b,c)=>{c.d(b,{A:()=>d});let d=(0,c(28731).A)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},44688:(a,b,c)=>{c.d(b,{A:()=>d});let d=(0,c(28731).A)("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]])},49269:(a,b,c)=>{c.d(b,{A:()=>d});let d=(0,c(28731).A)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]])},61407:(a,b,c)=>{c.d(b,{A:()=>r});var d=c(21124),e=c(38301),f=c(44688),g=c(28731);let h=(0,g.A)("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]);var i=c(47089),j=c(71563),k=c(81100),l=c(84122),m=c(40284);let n=(0,g.A)("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);var o=c(3663),p=c(49269),q=c(10643);function r({vehicleId:a,userRole:b}){let[c,g]=(0,e.useState)([]),[r,s]=(0,e.useState)(""),[t,u]=(0,e.useState)([]),[v,w]=(0,e.useState)(!1),[x,y]=(0,e.useState)(!1),[z,A]=(0,e.useState)(""),[B,C]=(0,e.useState)({}),[D,E]=(0,e.useState)(null),[F,G]=(0,e.useState)(""),[H,I]=(0,e.useState)(""),[J,K]=(0,e.useState)(""),L=(0,q.U)(),M=async()=>{try{w(!0);let{data:b,error:c}=await L.from("vehicle_inward_comments").select("*").eq("vehicle_inward_id",a).order("created_at",{ascending:!1});if(c)throw c;if(g(b||[]),b&&b.length>0){let a=b.map(a=>a.id),{data:c}=await L.from("vehicle_inward_comment_attachments").select("*").in("comment_id",a).order("created_at",{ascending:!1}),d={};c?.forEach(a=>{d[a.comment_id]||(d[a.comment_id]=[]),d[a.comment_id].push(a)}),C(d)}}catch(a){console.error("Error loading comments:",a)}finally{w(!1)}},N=async()=>{if(!r.trim()&&0===t.length)return void alert("Please enter a comment or attach a file");y(!0);try{let{data:{user:c}}=await L.auth.getUser();if(!c)return void alert("You must be logged in to add comments");let{data:d,error:e}=await L.from("vehicle_inward_comments").insert({vehicle_inward_id:a,comment:r.trim()||"(No comment - file attachment only)",created_by:z||c.email||c.id,role:b}).select().single();if(e)throw e;if(t.length>0&&d){let a=[];for(let b of t)try{let c=new FileReader,e=new Promise((a,d)=>{c.onload=()=>a(c.result),c.onerror=d,c.readAsDataURL(b)}),f=await e,{error:g}=await L.from("vehicle_inward_comment_attachments").insert({comment_id:d.id,file_name:b.name,file_url:f,file_type:b.type,file_size:b.size});g||a.push({file_name:b.name,file_url:f})}catch(a){console.error("Error uploading file:",a)}a.length>0&&await L.from("vehicle_inward_comments").update({attachments_count:a.length}).eq("id",d.id)}s(""),u([]),await M(),alert("Comment added successfully!")}catch(a){console.error("Error submitting comment:",a),alert(`Failed to add comment: ${a.message}`)}finally{y(!1)}},O=async a=>{if(!F.trim())return void alert("Comment cannot be empty");try{let{error:b}=await L.from("vehicle_inward_comments").update({comment:F.trim()}).eq("id",a);if(b)throw b;E(null),G(""),await M(),alert("Comment updated successfully!")}catch(a){console.error("Error updating comment:",a),alert(`Failed to update comment: ${a.message}`)}},P=()=>{E(null),G("")},Q=async a=>{if(confirm("Are you sure you want to delete this comment? This will also delete all attachments."))try{let{error:b}=await L.from("vehicle_inward_comments").delete().eq("id",a);if(b)throw b;await M(),alert("Comment deleted successfully!")}catch(a){console.error("Error deleting comment:",a),alert(`Failed to delete comment: ${a.message}`)}},R=async(a,b)=>{if(confirm("Are you sure you want to delete this attachment?"))try{let{error:c}=await L.from("vehicle_inward_comment_attachments").delete().eq("id",a);if(c)throw c;let d=(B[b]?.length||1)-1;await L.from("vehicle_inward_comments").update({attachments_count:d}).eq("id",b),await M(),alert("Attachment deleted successfully!")}catch(a){console.error("Error deleting attachment:",a),alert(`Failed to delete attachment: ${a.message}`)}},S=a=>"admin"===b||"manager"===b||a.created_by===H||a.created_by===J||a.created_by===z;return(0,d.jsxs)("div",{style:{marginTop:"2rem",padding:"1.5rem",backgroundColor:"#f9fafb",borderRadius:"0.75rem",border:"1px solid #e5e7eb"},children:[(0,d.jsxs)("h3",{style:{fontSize:"1rem",fontWeight:"700",color:"#111827",marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,d.jsx)(f.A,{style:{width:"1.25rem",height:"1.25rem"}}),"Comments & Attachments"]}),(0,d.jsxs)("div",{style:{backgroundColor:"white",borderRadius:"0.5rem",padding:"1rem",marginBottom:"1.5rem",border:"1px solid #e5e7eb"},children:[(0,d.jsx)("textarea",{value:r,onChange:a=>s(a.target.value),placeholder:"Add a comment...",style:{width:"100%",minHeight:"100px",padding:"0.75rem",border:"1px solid #d1d5db",borderRadius:"0.5rem",fontSize:"0.875rem",fontFamily:"inherit",resize:"vertical",outline:"none"},onFocus:a=>{a.target.style.borderColor="#3b82f6",a.target.style.boxShadow="0 0 0 3px rgba(59, 130, 246, 0.1)"},onBlur:a=>{a.target.style.borderColor="#d1d5db",a.target.style.boxShadow="none"}}),(0,d.jsxs)("div",{style:{marginTop:"0.75rem",marginBottom:"0.75rem"},children:[(0,d.jsxs)("label",{style:{display:"inline-flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:"#f3f4f6",border:"1px solid #d1d5db",borderRadius:"0.5rem",cursor:"pointer",fontSize:"0.875rem",fontWeight:"500",color:"#374151"},children:[(0,d.jsx)(h,{style:{width:"1rem",height:"1rem"}}),"Attach Files",(0,d.jsx)("input",{type:"file",multiple:!0,onChange:a=>{if(a.target.files){let b=Array.from(a.target.files);u(a=>[...a,...b].slice(0,5))}},style:{display:"none"},accept:"image/*,.pdf,.doc,.docx"})]}),t.length>0&&(0,d.jsx)("div",{style:{marginTop:"0.75rem",display:"flex",flexWrap:"wrap",gap:"0.5rem"},children:t.map((a,b)=>(0,d.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 0.75rem",backgroundColor:"#eff6ff",border:"1px solid #dbeafe",borderRadius:"0.5rem",fontSize:"0.75rem"},children:[(0,d.jsx)(h,{style:{width:"0.875rem",height:"0.875rem",color:"#2563eb"}}),(0,d.jsx)("span",{style:{color:"#1e40af",maxWidth:"200px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:a.name}),(0,d.jsx)("button",{onClick:()=>{u(a=>a.filter((a,c)=>c!==b))},style:{padding:"0.125rem",backgroundColor:"transparent",border:"none",cursor:"pointer",display:"flex",alignItems:"center"},children:(0,d.jsx)(i.A,{style:{width:"0.875rem",height:"0.875rem",color:"#dc2626"}})})]},b))})]}),(0,d.jsxs)("button",{onClick:N,disabled:x||!r.trim()&&0===t.length,style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.75rem 1.5rem",backgroundColor:x||!r.trim()&&0===t.length?"#9ca3af":"#2563eb",color:"white",border:"none",borderRadius:"0.5rem",fontSize:"0.875rem",fontWeight:"600",cursor:x||!r.trim()&&0===t.length?"not-allowed":"pointer",transition:"all 0.2s"},onMouseEnter:a=>{!x&&(r.trim()||t.length>0)&&(a.currentTarget.style.backgroundColor="#1d4ed8")},onMouseLeave:a=>{!x&&(r.trim()||t.length>0)&&(a.currentTarget.style.backgroundColor="#2563eb")},children:[(0,d.jsx)(j.A,{style:{width:"1rem",height:"1rem"}}),x?"Adding...":"Add Comment"]})]}),v?(0,d.jsx)("div",{style:{textAlign:"center",padding:"2rem",color:"#6b7280"},children:"Loading comments..."}):0===c.length?(0,d.jsx)("div",{style:{padding:"2rem",textAlign:"center",backgroundColor:"white",borderRadius:"0.5rem",border:"1px dashed #d1d5db",color:"#6b7280"},children:"No comments yet. Be the first to add one!"}):(0,d.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:c.map(a=>(0,d.jsxs)("div",{style:{backgroundColor:"white",borderRadius:"0.5rem",padding:"1rem",border:"1px solid #e5e7eb"},children:[(0,d.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"0.5rem"},children:[(0,d.jsxs)("div",{style:{flex:1},children:[(0,d.jsx)("div",{style:{fontWeight:"600",fontSize:"0.875rem",color:"#111827"},children:a.created_by}),(0,d.jsxs)("div",{style:{fontSize:"0.75rem",color:"#6b7280"},children:[a.role.charAt(0).toUpperCase()+a.role.slice(1)," â€¢ ",new Date(a.created_at).toLocaleString("en-IN",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})]})]}),S(a)&&(0,d.jsx)("div",{style:{display:"flex",gap:"0.5rem"},children:D===a.id?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("button",{onClick:()=>O(a.id),style:{padding:"0.25rem 0.5rem",backgroundColor:"#059669",color:"white",border:"none",borderRadius:"0.375rem",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.25rem",fontSize:"0.75rem",fontWeight:"500"},children:[(0,d.jsx)(k.A,{style:{width:"0.875rem",height:"0.875rem"}}),"Save"]}),(0,d.jsxs)("button",{onClick:P,style:{padding:"0.25rem 0.5rem",backgroundColor:"#6b7280",color:"white",border:"none",borderRadius:"0.375rem",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.25rem",fontSize:"0.75rem",fontWeight:"500"},children:[(0,d.jsx)(i.A,{style:{width:"0.875rem",height:"0.875rem"}}),"Cancel"]})]}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("button",{onClick:()=>{E(a.id),G(a.comment)},style:{padding:"0.25rem 0.5rem",backgroundColor:"#2563eb",color:"white",border:"none",borderRadius:"0.375rem",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.25rem",fontSize:"0.75rem",fontWeight:"500"},children:[(0,d.jsx)(l.A,{style:{width:"0.875rem",height:"0.875rem"}}),"Edit"]}),(0,d.jsxs)("button",{onClick:()=>Q(a.id),style:{padding:"0.25rem 0.5rem",backgroundColor:"#dc2626",color:"white",border:"none",borderRadius:"0.375rem",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.25rem",fontSize:"0.75rem",fontWeight:"500"},children:[(0,d.jsx)(m.A,{style:{width:"0.875rem",height:"0.875rem"}}),"Delete"]})]})})]}),D===a.id?(0,d.jsx)("textarea",{value:F,onChange:a=>G(a.target.value),style:{width:"100%",minHeight:"80px",padding:"0.75rem",border:"1px solid #3b82f6",borderRadius:"0.5rem",fontSize:"0.875rem",fontFamily:"inherit",resize:"vertical",outline:"none",marginBottom:"0.75rem"}}):(0,d.jsx)("div",{style:{fontSize:"0.875rem",color:"#374151",lineHeight:"1.6",marginBottom:a.attachments_count&&a.attachments_count>0||B[a.id]&&B[a.id].length>0?"0.75rem":"0"},children:a.comment}),B[a.id]&&B[a.id].length>0&&(0,d.jsxs)("div",{style:{padding:"0.75rem",backgroundColor:"#f9fafb",borderRadius:"0.375rem",display:"flex",flexDirection:"column",gap:"0.5rem"},children:[(0,d.jsxs)("div",{style:{fontSize:"0.75rem",fontWeight:"600",color:"#374151",marginBottom:"0.25rem"},children:["\uD83D\uDCCE Attachments (",B[a.id].length,")"]}),B[a.id].map(b=>(0,d.jsxs)("a",{href:b.file_url,target:"_blank",rel:"noopener noreferrer",style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem",backgroundColor:"white",borderRadius:"0.375rem",border:"1px solid #e5e7eb",textDecoration:"none",color:"#2563eb",fontSize:"0.75rem",transition:"all 0.2s"},onMouseEnter:a=>{a.currentTarget.style.backgroundColor="#eff6ff",a.currentTarget.style.borderColor="#3b82f6"},onMouseLeave:a=>{a.currentTarget.style.backgroundColor="white",a.currentTarget.style.borderColor="#e5e7eb"},children:[b.file_type?.startsWith("image/")?(0,d.jsx)(n,{style:{width:"1rem",height:"1rem"}}):(0,d.jsx)(o.A,{style:{width:"1rem",height:"1rem"}}),(0,d.jsx)("span",{style:{flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:b.file_name}),b.file_size&&(0,d.jsxs)("span",{style:{fontSize:"0.7rem",color:"#6b7280"},children:[(b.file_size/1024).toFixed(1)," KB"]}),(0,d.jsx)(p.A,{style:{width:"0.875rem",height:"0.875rem"}}),S(a)&&(0,d.jsx)("button",{onClick:c=>{c.preventDefault(),c.stopPropagation(),R(b.id,a.id)},style:{padding:"0.25rem",backgroundColor:"transparent",border:"none",cursor:"pointer",display:"flex",alignItems:"center",marginLeft:"0.5rem"},children:(0,d.jsx)(m.A,{style:{width:"0.875rem",height:"0.875rem",color:"#dc2626"}})})]},b.id))]})]},a.id))})]})}},71563:(a,b,c)=>{c.d(b,{A:()=>d});let d=(0,c(28731).A)("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]])},72567:(a,b,c)=>{c.d(b,{A:()=>d});let d=(0,c(28731).A)("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]])},81100:(a,b,c)=>{c.d(b,{A:()=>d});let d=(0,c(28731).A)("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]])},84122:(a,b,c)=>{c.d(b,{A:()=>d});let d=(0,c(28731).A)("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]])}};